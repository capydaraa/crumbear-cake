{% extends "admin_base.html" %}
{% block title %}Manage Flavors - Admin{% endblock %}
{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-md-8"><h1>Manage Flavors</h1></div>
        <div class="col-md-4 text-end">
            <button class="btn btn-lg" style="background-color: #AC4037; color: white;" data-bs-toggle="modal" data-bs-target="#addModal">
                <i class="bi bi-plus-circle"></i> Add Flavor
            </button>
        </div>
    </div>
    <div class="card shadow-sm">
        <div class="card-body">
            <table class="table table-hover">
                <thead><tr><th>ID</th><th>Name</th><th>Price per Layer (₱)</th><th>Available</th><th>Actions</th></tr></thead>
                <tbody>
                    {% for item in flavors %}
                    <tr>
                        <td>{{ item.flavor_id }}</td>
                        <td><strong>{{ item.name }}</strong></td>
                        <td>₱{{ "%.2f"|format(item.price_per_layer) }}</td>
                        <td>{% if item.is_available %}<span class="badge bg-success">Yes</span>{% else %}<span class="badge bg-secondary">No</span>{% endif %}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="editItem({{ item.flavor_id }}, '{{ item.name }}', {{ item.price_per_layer }}, {{ item.is_available|lower }})">Edit</button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteItem({{ item.flavor_id }}, '{{ item.name }}')">Delete</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="addModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #EDCAD4;"><h5 class="modal-title">Add Flavor</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
            <form action="{{ url_for('admin_add_flavor') }}" method="POST">
                <div class="modal-body">
                    <div class="mb-3"><label class="form-label">Name *</label><input type="text" class="form-control" name="name" required></div>
                    <div class="mb-3"><label class="form-label">Price per Layer (₱) *</label><input type="number" step="0.01" class="form-control" name="price_per_layer" required></div>
                    <div class="mb-3 form-check"><input type="checkbox" class="form-check-input" name="is_available" value="1" checked><label class="form-check-label">Available</label></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn" style="background-color: #AC4037; color: white;">Add</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #EDCAD4;"><h5 class="modal-title">Edit Flavor</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
            <form id="editForm" method="POST">
                <input type="hidden" id="editId">
                <div class="modal-body">
                    <div class="mb-3"><label class="form-label">Name *</label><input type="text" class="form-control" id="editName" name="name" required></div>
                    <div class="mb-3"><label class="form-label">Price per Layer (₱) *</label><input type="number" step="0.01" class="form-control" id="editPrice" name="price_per_layer" required></div>
                    <div class="mb-3 form-check"><input type="checkbox" class="form-check-input" id="editAvailable" name="is_available" value="1"><label class="form-check-label">Available</label></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn" style="background-color: #AC4037; color: white;">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function editItem(id, name, price, available) {
    document.getElementById('editId').value = id;
    document.getElementById('editName').value = name;
    document.getElementById('editPrice').value = price;
    document.getElementById('editAvailable').checked = available;
    document.getElementById('editForm').action = `/admin/flavors/edit/${id}`;
    new bootstrap.Modal(document.getElementById('editModal')).show();
}
function deleteItem(id, name) {
    if (confirm(`Delete "${name}"?`)) {
        fetch(`/admin/flavors/delete/${id}`, {method: 'POST'})
        .then(r => r.json()).then(d => { if(d.success) location.reload(); else alert('Error: ' + d.message); });
    }
}
</script>
{% endblock %}

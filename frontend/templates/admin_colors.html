{% extends "admin_base.html" %}
{% block title %}Manage Colors - Admin{% endblock %}
{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-md-8"><h1>Manage Icing Colors</h1></div>
        <div class="col-md-4 text-end">
            <button class="btn btn-lg" style="background-color: #AC4037; color: white;" data-bs-toggle="modal" data-bs-target="#addModal">
                <i class="bi bi-plus-circle"></i> Add Color
            </button>
        </div>
    </div>
    <div class="card shadow-sm">
        <div class="card-body">
            <table class="table table-hover">
                <thead><tr><th>ID</th><th>Color</th><th>Hex Code</th><th>Shade</th><th>Available</th><th>Actions</th></tr></thead>
                <tbody>
                    {% for item in colors %}
                    <tr>
                        <td>{{ item.color_id }}</td>
                        <td><span style="display:inline-block;width:20px;height:20px;background-color:{{ item.hex_code }};border:1px solid #ccc;margin-right:8px;"></span><strong>{{ item.color_name }}</strong></td>
                        <td><code>{{ item.hex_code }}</code></td>
                        <td><span class="badge" style="background-color: #BF6865;">{{ item.shade }}</span></td>
                        <td>{% if item.is_available %}<span class="badge bg-success">Yes</span>{% else %}<span class="badge bg-secondary">No</span>{% endif %}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="editItem({{ item.color_id }}, '{{ item.color_name }}', '{{ item.hex_code }}', '{{ item.shade }}', {{ item.is_available|lower }})">Edit</button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteItem({{ item.color_id }}, '{{ item.color_name }}')">Delete</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="addModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #EDCAD4;"><h5 class="modal-title">Add Color</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
            <form action="{{ url_for('admin_add_color') }}" method="POST">
                <div class="modal-body">
                    <div class="mb-3"><label class="form-label">Color Name *</label><input type="text" class="form-control" name="color_name" required></div>
                    <div class="mb-3"><label class="form-label">Hex Code *</label><input type="text" class="form-control" name="hex_code" placeholder="#FF0000" required></div>
                    <div class="mb-3"><label class="form-label">Shade *</label>
                        <select class="form-select" name="shade" required>
                            <option value="Light">Light</option>
                            <option value="Medium">Medium</option>
                            <option value="Dark">Dark</option>
                        </select>
                    </div>
                    <div class="mb-3 form-check"><input type="checkbox" class="form-check-input" name="is_available" value="1" checked><label class="form-check-label">Available</label></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn" style="background-color: #AC4037; color: white;">Add</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #EDCAD4;"><h5 class="modal-title">Edit Color</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
            <form id="editForm" method="POST">
                <input type="hidden" id="editId">
                <div class="modal-body">
                    <div class="mb-3"><label class="form-label">Color Name *</label><input type="text" class="form-control" id="editName" name="color_name" required></div>
                    <div class="mb-3"><label class="form-label">Hex Code *</label><input type="text" class="form-control" id="editHex" name="hex_code" required></div>
                    <div class="mb-3"><label class="form-label">Shade *</label>
                        <select class="form-select" id="editShade" name="shade" required>
                            <option value="Light">Light</option>
                            <option value="Medium">Medium</option>
                            <option value="Dark">Dark</option>
                        </select>
                    </div>
                    <div class="mb-3 form-check"><input type="checkbox" class="form-check-input" id="editAvailable" name="is_available" value="1"><label class="form-check-label">Available</label></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn" style="background-color: #AC4037; color: white;">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function editItem(id, name, hex, shade, available) {
    document.getElementById('editId').value = id;
    document.getElementById('editName').value = name;
    document.getElementById('editHex').value = hex;
    document.getElementById('editShade').value = shade;
    document.getElementById('editAvailable').checked = available;
    document.getElementById('editForm').action = `/admin/colors/edit/${id}`;
    new bootstrap.Modal(document.getElementById('editModal')).show();
}
function deleteItem(id, name) {
    if (confirm(`Delete "${name}"?`)) {
        fetch(`/admin/colors/delete/${id}`, {method: 'POST'})
        .then(r => r.json()).then(d => { if(d.success) location.reload(); else alert('Error: ' + d.message); });
    }
}
</script>
{% endblock %}
